{% load static %}

<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>USER login</title>
  <script src="{% static "scripts/jquery.min.js" %}"></script>
  <script type="text/javascript">

  // ajax for checking authentication
    $.ajax({
    url: "/check_token/",
    type: 'get',
    headers: {
    Authorization: "Token " +localStorage.token,
     },
    statusCode: {
      200: function() {
      window.stop();
      $(location).attr('href', 'http://127.0.0.1:8000/green/');
      }
      
    }
  });
  </script>
  <link type="text/css" rel="stylesheet" href="{% static "styles/user_home.css" %}"/>
  <link rel="stylesheet" type="text/css" href="{% static "styles/font-awesome.min.css" %}">
  <script type="text/javascript" src="{% static "scripts/homepage_user.js" %}"></script>
  <link rel="icon" type="image/png" href="{% static "images/fevicon.png" %}">
</head>


<body class="bdy">





    <!--Login box-->
<form name="login_form" action="/userlogin/" onsubmit="return login()" method="post">
<div class="login">
  <form>
  <input type="text" class="log_input" placeholder="Email or Phone" name="username" required="required">
  <br>
  <input type="password" class="log_input" placeholder="Password" name="password" required="required">
  <br>

  <input id="log_sub_button" type="submit" name="submit" value="Log In"> 
  </form>
  <span><a href="{% url "forgot" %}" id="forgot_pass">Forgot Password ?</a></span>
  <br>
  <p id="cred_error">Wrong Email or password</p>
</div>
</form>






     <!--user/creator selector-->

<div class="dropdown">
  <button onclick="myFunction()" class="dropbtn">User<span class="caret"></span></button>
  <div id="myDropdown" class="dropdown-content">
    <a href="{% url "channel" %}">Channel</a>
  </div>
</div>



     <!--Logo/ What is VityPros Label-->

<div class="home_logo">
  <img src="{% static "images/logob.png" %}" height="50px"  alt="VP">
  <span id="aboutvp">What Is VityPro?</span>
</div>



     <!--What is Vitypro . Explained (MODAL)-->

<div class="vp_explained">
 <span class="close"> <img src="{% static "images/close-icon.png" %}"> </span>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p> 
</div>



     <!--Call to action and Sign Up button-->

<div class="call2act">
  <p class="slogan">TAKE</br>BACK</br><span id="the">THE</span></br>CONTROL</p>
  <button type="button" class="sign_up">Sign Up</button>
</div>



     <!--Sign up form (MODAL)-->
<form name="su_form" id="form" action="/usersignup/" onsubmit="return validateForm()" method="post" autocomplete="off">

<div class="modal to_hid">
  <div class="nd_div">
      <div class="loading">
            <center>
            <h2 style="font-family: Segoe UI Light;font-size: 25px;padding-bottom: 20px;">Signing you up...</h2><br />

              <img class="loader" src="{% static "images/294.gif" %}"   />
             </center>
      </div>
    <div class="s_form">
    <span class="close"> <img src="{% static "images/close-icon.png" %}"> </span>
      <div id="reg_label">
      <center><h2>Register for VityPros</h2></center>
      </div>

      <div class="fgd" >
                
              <div class="co6 tooltip">
                    <div>
                      <h4 >You are </h4>
                         <label class="color"><input type="radio" class="vp_radio-btn" name="sex" value="male">Male</label>
                         <label class=" color"><input type="radio" class="vp_radio-btn" name="sex" value="female">Female</label>
                    </div>
                    <span id="gend" class="tooltiptext">Required Options</span>
              </div>
              <div class="co6 tooltip2" id="pr41">
                      <h4 >Birthday</h4>
                    
              <fieldset id="38">
                <span>
                  <select id="day" name="day" class="vp-dateOfBirth">
                  <option value="">Day</option>
                  <option value="01">01</option>
                  <option value="02">02</option>
                  <option value="03">03</option>
                  <option value="04">04</option>
                  <option value="05">05</option>
                  <option value="06">06</option>
                  <option value="07">07</option>
                  <option value="08">08</option>
                  <option value="09">09</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="25">25</option>
                  <option value="26">26</option>
                  <option value="27">27</option>
                  <option value="28">28</option>
                  <option value="29">29</option>
                  <option value="30">30</option>
                  <option value="31">31</option>
                  </select>
                </span>
                <span>
                  <select id="month" name="month" class="vp-dateOfBirth">
                  <option value="">month</option>
                  <option value="1">jan</option>
                  <option value="2">feb</option>
                  <option value="3">march</option>
                  <option value="4">april</option>
                  <option value="5">may</option>
                  <option value="6">june</option>
                  <option value="7">july</option>
                  <option value="8">aug</option>
                  <option value="9">sep</option>
                  <option value="10">oct</option>
                  <option value="11">nov</option>
                  <option value="12">dec</option>
                  </select>
                </span>
                <span>
                  <select id="year" name="year" class="vp-dateOfBirth">
                  <option value="">Year</option>
                  <option value="2019">2019</option>
                  <option value="2018">2018</option>
                  <option value="2017">2017</option>
                  <option value="2016">2016</option>
                  <option value="2015">2015</option>
                  <option value="2014">2014</option>
                  <option value="2013">2013</option>
                  <option value="2012">2012</option>
                  <option value="2011">2011</option>
                  <option value="2010">2010</option>
                  <option value="2009">2009</option>
                  <option value="2008">2008</option>
                  <option value="2007">2007</option>
                  <option value="2006">2006</option>
                  <option value="2005">2005</option>
                  <option value="2004">2004</option>
                  <option value="2003">2003</option>
                  <option value="2002">2002</option>
                  <option value="2001">2001</option>
                  <option value="2000">2000</option>
                  <option value="1999">1999</option>
                  <option value="1998">1998</option>
                  <option value="1997">1997</option>
                  <option value="1996">1996</option>
                  <option value="1995">1995</option>
                  <option value="1994">1994</option>
                  <option value="1993">1993</option>
                  <option value="1992">1992</option>
                  <option value="1991">1991</option>
                  <option value="1990">1990</option>
                  <option value="1989">1989</option>
                  <option value="1988">1988</option>
                  <option value="1987">1987</option>
                  <option value="1986">1986</option>
                  <option value="1985">1985</option>
                  <option value="1984">1984</option>
                  <option value="1983">1983</option>
                  <option value="1982">1982</option>
                  <option value="1981">1981</option>
                  <option value="1980">1980</option>
                  <option value="1979">1979</option>
                  <option value="1978">1978</option>
                  <option value="1977">1977</option>
                  <option value="1976">1976</option>
                  <option value="1975">1975</option>
                  <option value="1974">1974</option>
                  <option value="1973">1973</option>
                  <option value="1972">1972</option>
                  <option value="1971">1971</option>
                  <option value="1970">1970</option>
                  <option value="1969">1969</option>
                  <option value="1968">1968</option>
                  <option value="1967">1967</option>
                  <option value="1966">1966</option>
                  <option value="1965">1965</option>
                  <option value="1964">1964</option>
                  <option value="1963">1963</option>
                  <option value="1962">1962</option>
                  <option value="1961">1961</option>
                  <option value="1960">1960</option>
                  <option value="1959">1959</option>
                  <option value="1958">1958</option>
                  <option value="1957">1957</option>
                  <option value="1956">1956</option>
                  <option value="1955">1955</option>
                  <option value="1954">1954</option>
                  <option value="1953">1953</option>
                  <option value="1952">1952</option>
                  <option value="1951">1951</option>
                  <option value="1950">1950</option>
                  <option value="1949">1949</option>
                  <option value="1948">1948</option>
                  <option value="1947">1947</option>
                  <option value="1946">1946</option>
                  <option value="1945">1945</option>
                  <option value="1944">1944</option>
                  <option value="1943">1943</option>
                  <option value="1942">1942</option>
                  <option value="1941">1941</option>
                  <option value="1940">1940</option>
                  <option value="1939">1939</option>
                  <option value="1938">1938</option>
                  <option value="1937">1937</option>
                  <option value="1936">1936</option>
                  <option value="1935">1935</option>
                  <option value="1934">1934</option>
                  <option value="1933">1933</option>
                  
                  </select>
                </span>
              </fieldset>
              <span id="bday" class="tooltiptext2">Required Options</span>             
          </div>
      </div>


    <div class="age16">
      VityPro is only eligible for people above the age of 16. 
    </div>



    <div class="inl_bl tooltip">
    <input type="text" class="common_input" id="first_name" name="first_name" placeholder="First Name">
    <span id="f_name" class="tooltiptext">Required Field</span>
    </div>
    <div class="inl_bl tooltip2">
    <input type="text" class="common_input" id="last_name" name="last_name" placeholder="Surname"><br>
    <span id="l_name" class="tooltiptext2">Required Field</span>
    </div>
    <div class="tooltip1">
    <input type="text" class="common_input full_width" id="eop" name="email" placeholder="Email or Phone no."><br>
    <span id="email" class="tooltiptext1"></span>
    </div>
    <div class="tooltip1">
    <input type="text" class="common_input full_width" id="username_input" name="username" placeholder="Username"><br>
        <div id="tick">
          <span class="fa fa-undo" id="undo"></span>
          <span class="fa fa-times-circle-o" id="times"></span>
          <span class="fa fa-check" id="check"></span>
        </div>
    <span id="username" class="tooltiptext1">Required Field</span>
    </div>
    <div class="tooltip1">
    <input type="password" class="common_input full_width" name="password" placeholder="Password"><br>
    <span id="pass" class="tooltiptext1">Required Field</span>
    </div>
    <p>By clicking Sign Up you agree to our <a href="http://127.0.0.1:8000/green/">Terms</a> , <a href="http://127.0.0.1:8000/about/">Data policy</a> &#38 <a href="#">Cookie Use Policy</a>.</p>
    <button class="btn">Sign Up</button><br>
        <div class="channel_link">
                          <a href="#"><strong>Create a Channel</strong></a> for Celebrity, Cause, etc.
        </div>
    </div>
  </div>  
</div>
</form>


<script>
  $(document).ready(function(){
    $("#aboutvp").click(function(){
      $(".vp_explained").css('display','block');
      $(".call2act").css('display','none');
  });


    $(".close").click(function(){
      $(".vp_explained").css('display','none');
      $(".call2act").css('display','block');
      $(".modal").css('display','none');
      $(".home_logo").css('display','block');
  });


    $("button.sign_up").click(function(){
      $(".modal").css('display','block');
      $(".call2act").css('display','none');
      $(".home_logo").css('display','none');
    });


    $("#first_name").blur(function(){
      generate_username();
    });

    $("#last_name").blur(function(){
      generate_username();
    });


    function generate_username(){
      var fn = document.forms["su_form"]["first_name"].value;
      var ln = document.forms["su_form"]["last_name"].value;
      if (fn != "" && ln != "") {
        
        var arr = [
         fn, ln, fn+ln, ln+fn, fn.charAt(0)+ln, ln.charAt(0)+fn,
         ln+fn.charAt(0), fn+ln.charAt(0), fn+"00", fn+"11", fn+"22",
         fn+"33", fn+"44", fn+"55", fn+"66", fn+"77", fn+"88", fn+"99",
         fn+"000", fn+"111", fn+"222", fn+"333", fn+"444", fn+"555", fn+"666", fn+"777",
         fn+"888", fn+"999", fn+"123", fn+"007", ln+"00", ln+"11", ln+"22",
         ln+"33", ln+"44", ln+"55", ln+"66", ln+"77", ln+"88", ln+"99",
         ln+"000", ln+"111", ln+"222", ln+"333", ln+"444", ln+"555", ln+"666", ln+"777",
         ln+"888", ln+"999", ln+"123", ln+"007", fn+"12", fn+"13", fn+"14", fn+"15", fn+"16",
         fn+"17", fn+"18", fn+"19", fn+"20", fn+"21", fn+"23", fn+"24", fn+"25", fn+"26",
         fn+"27", fn+"28", fn+"29", fn+"30", fn+"31", fn+"32", fn+"34", fn+"35", fn+"37",
         fn+"38", fn+"39", fn+"40", fn+"41", fn+"42", fn+"43", fn+"45", fn+"46", fn+"47",
         fn+"48", fn+"49", fn+"50", ln+"12", ln+"13", ln+"14", ln+"15", ln+"16",
         ln+"17", ln+"18", ln+"19", ln+"20", ln+"21", ln+"23", ln+"24", ln+"25", ln+"26",
         ln+"27", ln+"28", ln+"29", ln+"30", ln+"31", ln+"32", ln+"34", ln+"35", ln+"37",
         ln+"38", ln+"39", ln+"40", ln+"41", ln+"42", ln+"43", ln+"45", ln+"46", ln+"47"
         ];
        var usernames = JSON.stringify(arr);
        

        $.ajax({
          url: "/check_username_list/",
          type: "post",
          data: {
            usernames
          },
          statusCode: {
            200: function(result) {
              console.log(result);
              uc = 0;
              ulist = result;
              $("#undo").show();
              //$("#username_input").val(result[0]);
          } 
          }
        });
      }


    }//generate username


    $("#username_input").blur(function(){
      var username  = document.forms["su_form"]["username"].value;
      if (username != "") {
        $.ajax({
          url: "/check_username/",
          type: "post",
          data: {
            "username": username
          },
          statusCode: {
            200: function() {
              $("#times").hide();
              $("#check").show();
            },
            400: function() {
              $("#check").hide();
              $("#times").show();
            }
          }
        });
      }
      else{
        $("#times").hide();
        $("#check").hide();
        }
    });


    $("#undo").click(function(){
      $("#username_input").val(ulist[uc]);
      uc += 1;
      if (uc > 9) {
        uc = 0;
      }
      $("#check").show();

    });



}); //Document.ready





function validateForm() {
    var a  = document.forms["su_form"]["sex"].value;
    var b1 = document.forms["su_form"]["day"].value;
    var b2 = document.forms["su_form"]["month"].value;
    var b3 = document.forms["su_form"]["year"].value;
    var c  = document.forms["su_form"]["first_name"].value;
    var d  = document.forms["su_form"]["last_name"].value;
    var e  = document.forms["su_form"]["email"].value;
    var f  = document.forms["su_form"]["username"].value;
    var g  = document.forms["su_form"]["password"].value;
    

    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth()+1; //January is 0!
    var yyyy = today.getFullYear();


    //set the value of hidden input field to that of 'email or phone' field
    //$("#logid").val($("#eop").val());


    if (a != "") {
      $("#gend").removeClass("disblock");      
    }

    if (b1 != "" && b2 != "" && b3 != "") {
      $("#bday").removeClass("disblock"); 
    }

    if (c != "") {
      $("#f_name").removeClass("disblock"); 
    }

    if (d != "") {
      $("#l_name").removeClass("disblock"); 
    }

    if (e != "") {
      $("#email").removeClass("disblock"); 
      $('#email').empty();
    }

    if (f != "") {
      $("#username").removeClass("disblock"); 
    }

    if (g != "") {
      $("#pass").removeClass("disblock"); 
    } 





    if (a == "") {
      $("#gend").addClass("disblock");
      return false;
    }
    else if (b1 == "" || b2 == "" || b3 == "") {
      $("#bday").addClass("disblock");
      return false;
    }




    // check if the person is above 16 


    if (Number(b3)+16 > yyyy) {
      $(".age16").addClass("disblock");
      return false;
    }
    else if (Number(b3)+16 < yyyy) {
      $(".age16").removeClass("disblock");
      // pass
    }
    else if (Number(b3)+16 == yyyy) {
      if (Number(b2) < mm ) {
        $(".age16").addClass("disblock");
        return false;
      }
      else if (Number(b2) > mm ) {
        $(".age16").removeClass("disblock");
        // Pass
      }
      else if (Number(b2) == mm ) {
        if (Number(b1) < dd) {
          $(".age16").addClass("disblock");
          return false;
        }
        else {
          $(".age16").removeClass("disblock");
          // Pass
        }
      }
    }






    if (c == "") {
      $("#f_name").addClass("disblock");
      return false;
    }
    else if (d == "") {
      $("#l_name").addClass("disblock");
      return false;
    }
    else if (e == "") {
      $('#email').empty().append("Required Field").addClass("disblock");
      return false;
    }

    var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;  // regex to check email validity
    var numbers = /^[0-9]+$/; // regex to check integer or not
    var phoneno = /^\d{10}$/; // regex for checking validity of phone no.



    if (e.match(numbers)) {
      if (e.match(phoneno)) {
        $("#eop").attr("name","phone"); //change email field name to phone
        var h = document.forms["su_form"]["phone"].value;
        var e = undefined;
        //pass
      }
      else {
        $('#email').empty().append("Invalid Phone no.").addClass("disblock");
        return false;
      }
    }
    else {
      if (e.match(mailformat)) {
        //pass
      }
      else {
        $('#email').empty().append("Invalid Email address").addClass("disblock");
        return false;
      }
    }



    if (f == "") {
      $('#username').empty().append("Required Field").addClass("disblock");
      return false;
    }


    if (g == "") {
      $('#pass').empty().append("Required Field").addClass("disblock");
      return false;
    }


    if (g.length < 6 ) {
      $('#pass').empty().append("Password must be at least 6 character").addClass("disblock");
      return false;
    }








    //validate username
    $.ajax({
    url: "/usersignup/",
    type: 'post',
    data: {
      "sex": a,
      "day": b1,
      "month": b2,
      "year": b3,
      "first_name": c,
      "last_name": d,
      "email": e,
      "username": f,
      "password": g,
      "phone": h
    },
    statusCode: {
      400: function(result) {
        if (result['responseJSON'].username == "my user with this username already exists.") {
          invalidUsername();
        }

        if (result['responseJSON'].email == "my user with this email already exists.") {
          invalidEmail();
        }

        if (result['responseJSON'].phone == "my user with this phone already exists.") {
          invalidPhone();
        }
      },
      201: function(result) {
        var email = result.email;
        var phone = result.phone;
        var password = result.password;
        if (email !== undefined) {
          login2(email, password);
        } else if (phone !== undefined) {
            login2(phone, password);
          }
      }
    }
  });


    function invalidEmail() {
      $('#email').empty().append("Email already exist").addClass("disblock");
    }

    function invalidPhone() {
      $('#email').empty().append("Phone already exist").addClass("disblock");
    }

    function invalidUsername() {
      $('#username').empty().append("Username already exist").addClass("disblock");
    }



  return false;


function login2(username, password) {


  $.ajax({
    url: "/userlogin/",
    type: 'post',
    data: {
      "username":username,
      "password":password
    },
    success: function(result){
      localStorage.token = result.token;
      $(location).attr('href', 'http://127.0.0.1:8000/green/');
    }
  });

  return false;

}




}  // ValidateForm function





// Log the user in 

function login() {
  var username  = document.forms["login_form"]["username"].value;
  var password  = document.forms["login_form"]["password"].value;

  $.ajax({
    url: "/userlogin/",
    type: 'post',
    data: {
      "username":username,
      "password":password
    },
    success: function(result){
      localStorage.removeItem("token");
      localStorage.token = result.token;
      $(location).attr('href', 'http://127.0.0.1:8000/green/');
    },
    error: function(){
      $("#cred_error").show();
    }
  });

  return false;

}








</script>






</body>
</html>
